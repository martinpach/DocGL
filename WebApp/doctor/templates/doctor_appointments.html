<div class="row doctor-appointments">
    <div class="col-md-6">
        <h1 class="heading" id="heading">Appointments</h1>
    </div>
    <div class="col-md-6">
        <form class="form-inline pull-right">
            <input type="text" class="form-control datepicker" placeholder="day" id="day-input">
            <input type="text" class="form-control datepicker" placeholder="week" id="week-input">
        </form>
    </div>
</div>
<div class="container contentTab z-depth-1" id="contentTab">
</div>
<div id="appointmentModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header text-center">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title headingModal">Appointment details</h4>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Done</button>
            </div>
        </div>
    </div>
</div>
<script>
var appointments;

$('#day-input').change(function() {
	$('#contentTab').empty();
    ajaxRequest(localStorage.getItem("id"), "appointments?date="+$(this).val()).done(function () {
    	for (var i = 0; i < appointments.length; i++) {
        var appointmentBox = $('<div class="appointment-day"></div>');
        var appointmentTimeBox = $('<div class="time"></div>');
        var appointmentPatientBox = $('<div class="patient"></div>');
        var appointmentNoteBox = $('<p class="note"></p>');
        var colMd4 = $('<div class="col-md-4"></div>');
        appointmentTimeBox.text(appointments[i].time);
        appointmentPatientBox.text((appointments[i].patientFirstName == "" ? appointments[i].patient.firstName : appointments[i].patientFirstName) + " " + (appointments[i].patientLastName == "" ? appointments[i].patient.lastName : appointments[i].patientLastName));
        appointmentNoteBox.text(appointments[i].note);
        appointmentBox.append(appointmentTimeBox, appointmentPatientBox, appointmentNoteBox);
        appointmentBox.appendTo(colMd4);
        colMd4.appendTo('#contentTab');
    }
    });
});

$('#week-input').change(function() {
    for (var i = 0; i < 7; i++) {
        var appointmentsOnDate = $('<div class="col-md-1">' + i + '</div>');

    }
});

$(function() {
    $(".datepicker").datepicker({
        dateFormat: "yy-mm-dd"
    });
});

function ajaxRequest(id, sufix) {
    var deferred = $.Deferred();
    $.ajax({
        beforeSend: function(xhr) {
            xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.getItem("token"));
        },
        url: 'http://localhost:8085/api/doctors/' + id + '/' + sufix,
        type: 'GET',
        contentType: 'application/json',
        success: function(data) {            
            appointments = data;
            console.log(appointments);
            deferred.resolve();
        },
        error: function() {
            deferred.reject();
        }
    });
    return deferred.promise();
}
</script>
